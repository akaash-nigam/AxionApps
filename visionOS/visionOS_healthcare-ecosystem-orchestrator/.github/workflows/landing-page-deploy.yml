name: Deploy Landing Page

on:
  push:
    branches: [ main ]
    paths:
      - 'landing-page/**'
  workflow_dispatch:

jobs:
  deploy-to-pages:
    name: Deploy to GitHub Pages
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pages: write
      id-token: write

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Pages
      uses: actions/configure-pages@v4

    - name: Optimize assets
      run: |
        echo "Preparing landing page for deployment..."

        # Create deployment directory
        mkdir -p _site

        # Copy landing page assets
        cp -r landing-page/* _site/

        # Create .nojekyll to bypass Jekyll processing
        touch _site/.nojekyll

        echo "Landing page ready for deployment"

    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: '_site'

    - name: Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    - name: Summary
      run: |
        echo "## ðŸš€ Deployment Successful" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Landing page deployed to GitHub Pages!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/" >> $GITHUB_STEP_SUMMARY

  deploy-to-netlify:
    name: Deploy to Netlify (Alternative)
    runs-on: ubuntu-latest
    if: false  # Enable if Netlify is configured

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Deploy to Netlify
      uses: netlify/actions/cli@master
      with:
        args: deploy --prod --dir=landing-page
      env:
        NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}

  performance-audit:
    name: Lighthouse Performance Audit
    runs-on: ubuntu-latest
    needs: deploy-to-pages

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Run Lighthouse CI
      uses: treosh/lighthouse-ci-action@v10
      with:
        urls: |
          https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/
        uploadArtifacts: true
        temporaryPublicStorage: true

    - name: Lighthouse Report Summary
      run: |
        echo "## ðŸ“Š Lighthouse Performance Report" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Performance audit completed!" >> $GITHUB_STEP_SUMMARY
        echo "Check artifacts for detailed results." >> $GITHUB_STEP_SUMMARY
